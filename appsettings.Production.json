{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.Hosting.Lifetime": "Information"
    }
  },
  "Proxy": {
    "ListeningPort": 14330,
    "WorkerCount": 96,
    "ChannelCapacity": 8000,
    "MaxMessageBytes": 1048576,
    "MetricsReportIntervalSeconds": 10,
    "QueueEngine": "RabbitMq",
    "EnableMarsPassthrough": false,
    "ForceQueueOnly": false,
    "FallbackToPassthroughOnEncryptOff": true,
    "EnforceClientAllowlist": true,
    "AllowedClientCidrs": [
      "10.0.0.0/8",
      "172.16.0.0/12"
    ],
    "TargetHost": "sql-prod.internal",
    "TargetPort": 1433,
    "TargetConnectMaxRetries": 5,
    "TargetConnectRetryDelayMs": 150,
    "MaxTargetConnections": 4000,
    "MinInFlightRequests": 64,
    "MaxInFlightRequests": 1024,
    "AdaptiveBackpressureEnabled": true,
    "QueueLowWatermark": 1500,
    "QueueHighWatermark": 6000,
    "TargetLatencyLowMs": 120,
    "TargetLatencyHighMs": 700,
    "RequestProcessingRetries": 2,
    "RequestRetryDelayMs": 50,
    "MaxReplayAttempts": 3,
    "PendingRequestTtlSeconds": 180,
    "Tls": {
      "Enabled": true,
      "CertificatePath": "${ENV:TDS_PROXY_TLS_CERT_PATH}",
      "CertificatePassword": "${ENV:TDS_PROXY_TLS_CERT_PASSWORD}",
      "ClientCertificateRequired": false,
      "CheckCertificateRevocation": true,
      "HandshakeTimeoutSeconds": 20
    },
    "RabbitMq": {
      "HostName": "rabbitmq-prod.internal",
      "Port": 5672,
      "UserName": "proxy_user",
      "Password": "${ENV:RABBITMQ_PASSWORD}",
      "VirtualHost": "/tdsproxy",
      "QueueName": "tdsqueue.proxy.requests.prod",
      "Durable": true,
      "PrefetchCount": 400,
      "PublishBatchSize": 128,
      "PublishBatchMaxDelayMs": 4,
      "PublishMaxRetries": 5,
      "PublishRetryDelayMs": 100,
      "ConsumeMaxRetries": 8,
      "ConsumeRetryDelayMs": 200,
      "ConsumerChannelRestartDelayMs": 500,
      "RequeueOnFailure": true,
      "UseTls": true,
      "TlsServerName": "rabbitmq-prod.internal",
      "TlsAcceptInvalidCertificates": false
    },
    "Redis": {
      "Configuration": "redis-prod.internal:6379,password=${ENV:REDIS_PASSWORD},abortConnect=false",
      "QueueKey": "tdsqueue:requests:prod",
      "ProcessingQueueKey": "tdsqueue:requests:prod:processing",
      "PopBlockTimeoutSeconds": 1,
      "EnqueueMaxRetries": 5,
      "EnqueueRetryDelayMs": 100,
      "ConsumeMaxRetries": 8,
      "ConsumeRetryDelayMs": 200,
      "RequeueOnFailure": true,
      "UseTls": true,
      "SslHost": "redis-prod.internal",
      "AbortOnConnectFail": false
    },
    "FaultInjection": {
      "Enabled": false,
      "ThrowProbability": 0,
      "DelayProbability": 0,
      "DelayMs": 50
    },
    "CircuitBreakerFailuresThreshold": 30,
    "CircuitBreakerOpenSeconds": 20
  },
  "Observability": {
    "ListenAddress": "127.0.0.1",
    "HealthPort": 18080,
    "EnableOtlpExporter": true,
    "OtlpEndpoint": "http://otel-collector.internal:4317",
    "EnableAdminEndpoint": true,
    "AllowRemoteAdmin": false,
    "AdminToken": "${ENV:TDS_PROXY_ADMIN_TOKEN}"
  }
}
